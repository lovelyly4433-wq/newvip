<!DOCTYPE html>
<html lang="th" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>กำลังพาไปยังหน้าปลอดภัย...</title>
  <meta name="description" content="Smart redirect with smooth progress, typewriter status, and wave animation." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* LIGHT THEME */
      --bg: radial-gradient(1200px 800px at 10% 10%, #ffe39f 0%, rgba(255, 227, 159, 0) 50%),
            radial-gradient(900px 700px at 90% 10%, #ffd1e3 0%, rgba(255, 209, 227, 0) 55%),
            radial-gradient(1000px 800px at 50% 90%, #c7f5ff 0%, rgba(199, 245, 255, 0) 60%),
            linear-gradient(145deg, #fff7e6 0%, #ffe6f2 50%, #e8faff 100%);
      --card: #ffffff;
      --text: #171717;
      --muted: #525252;
      --primary: #ff7a59;     /* coral */
      --primary-600: #ff5d36;
      --accent: #7c3aed;      /* violet */
      --accent-600: #6d28d9;
      --border: #eaeaea;
      --shadow: 0 10px 30px rgba(18, 18, 18, 0.10);
      --btn: #111827;
      --btn-text: #ffffff;
      --ring: rgba(124, 58, 237, 0.25);
    }

    html[data-theme="dark"] {
      --bg: radial-gradient(1200px 800px at 10% 10%, #2e2a5a 0%, rgba(46,42,90,0) 50%),
            radial-gradient(900px 700px at 90% 10%, #343b6b 0%, rgba(52,59,107,0) 55%),
            radial-gradient(1000px 800px at 50% 90%, #1d2a44 0%, rgba(29,42,68,0) 60%),
            linear-gradient(145deg, #111827 0%, #0b1220 100%);
      --card: #0f172a;
      --text: #f9fafb;
      --muted: #cbd5e1;
      --primary: #ffd166;     /* warm amber */
      --primary-600: #f4b740;
      --accent: #22d3ee;      /* cyan */
      --accent-600: #06b6d4;
      --border: #1f2a44;
      --shadow: 0 12px 34px rgba(0,0,0,0.45);
      --btn: #e2e8f0;
      --btn-text: #0f172a;
      --ring: rgba(34, 211, 238, 0.25);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
      color: var(--text);
      background: var(--bg);
      display: grid;
      place-items: center;
      overflow: hidden;
    }

    .wrap {
      width: min(780px, 92vw);
      position: relative;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 28px 28px 22px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .brand {
      display: inline-flex; align-items: center; gap: 10px;
      font-weight: 600; letter-spacing: 0.2px;
    }

    .brand .logo {
      width: 40px; height: 40px; border-radius: 12px;
      background: conic-gradient(from 180deg, var(--accent), var(--primary), var(--accent));
      position: relative;
      box-shadow: inset 0 0 0 6px #fff3, 0 4px 16px rgba(0,0,0,.12);
      isolation: isolate;
    }
    .brand .logo::after {
      content: ""; position: absolute; inset: 6px; border-radius: 8px;
      background: radial-gradient(60% 60% at 30% 30%, #fff8 0%, #fff0 60%);
      animation: pulse 2s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.06);} }

    .theme-toggle { 
      appearance: none; border: 1px solid var(--border); background: transparent;
      padding: 8px 12px; border-radius: 12px; cursor: pointer; font-weight: 500;
      color: var(--text); box-shadow: none; transition: transform .15s ease;
    }
    .theme-toggle:active { transform: translateY(1px); }

    .hero {
      display: grid; grid-template-columns: 160px 1fr; gap: 20px; align-items: center;
      padding: 8px 0 18px;
    }

    /* PROGRESS CIRCLE (SVG) */
    .dial {
      position: relative; width: 140px; height: 140px; display: grid; place-items: center;
    }
    .dial svg { width: 140px; height: 140px; transform: rotate(-90deg); }
    .dial .bg { stroke: #e5e7eb; opacity: .6; }
    html[data-theme="dark"] .dial .bg { stroke: #334155; opacity: .9; }
    .dial .fg { stroke: var(--accent); filter: drop-shadow(0 0 8px var(--ring)); }
    .dial .value { position: absolute; font-weight: 700; font-size: 28px; }
    .dial .cap { position: absolute; bottom: 14px; font-size: 12px; color: var(--muted); }

    .copy h1 {
      margin: 0 0 6px; font-size: clamp(20px, 4vw, 28px); font-weight: 600; line-height: 1.2;
    }
    .copy p.lead { margin: 0; color: var(--muted); font-weight: 400; }

    .status-area {
      margin: 18px 0 8px; height: 84px; overflow: hidden; border: 1px dashed var(--border); border-radius: 14px; padding: 12px 14px;
      background: linear-gradient(180deg, #fff8, #fff0);
    }
    html[data-theme="dark"] .status-area { background: linear-gradient(180deg, #0002, #0000); }

    .type { font-size: 14px; line-height: 1.5; min-height: 24px; }
    .type .caret { display: inline-block; width: 8px; height: 1.1em; background: var(--text); vertical-align: -2px; animation: blink 1s steps(1) infinite; }
    @keyframes blink { 0%,50%{opacity:1} 50.01%,100%{opacity:0} }

    .actions { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px; }
    .btn {
      appearance: none; cursor: pointer; border: 0; border-radius: 12px; padding: 12px 16px; font-weight: 600; letter-spacing: .2px;
      background: var(--btn); color: var(--btn-text); box-shadow: 0 4px 14px rgba(0,0,0,.12);
      transition: transform .12s ease, box-shadow .2s ease;
    }
    .btn:focus-visible { outline: 3px solid var(--ring); outline-offset: 2px; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 22px rgba(0,0,0,.14); }
    .btn.secondary { background: #f3f4f6; color: #111827; }
    html[data-theme="dark"] .btn.secondary { background: #1f2937; color: #e5e7eb; }

    .badges { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
    .badge { font-size: 12px; padding: 8px 10px; border-radius: 999px; border: 1px solid var(--border); background: #fff; color: #111827; }
    html[data-theme="dark"] .badge { background: #0b1220; color: #e5e7eb; }

    /* WAVES */
    .waves {
      position: absolute; left: 0; right: 0; bottom: -2px; height: 140px; pointer-events: none;
    }
    .waves svg { width: 160%; height: 100%; animation: drift 16s linear infinite; }
    @keyframes drift { 0% { transform: translateX(0); } 100% { transform: translateX(-30%); } }

    @media (max-width: 640px) {
      .hero { grid-template-columns: 1fr; }
      .dial { margin: 8px auto 2px; }
      .wrap { width: min(96vw, 740px); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="status" aria-live="polite">
      <div class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <span>Secure Session</span>
        </div>
        <button id="toggleTheme" class="theme-toggle" type="button" aria-label="Toggle theme">สลับธีม</button>
      </div>

      <div class="hero">
        <div class="dial" aria-label="ความคืบหน้าการเชื่อมต่อ">
          <svg viewBox="0 0 120 120">
            <circle class="bg" cx="60" cy="60" r="50" fill="none" stroke-width="12" />
            <circle class="fg" id="fg" cx="60" cy="60" r="50" fill="none" stroke-width="12" stroke-linecap="round" stroke-dasharray="314" stroke-dashoffset="314" />
          </svg>
          <div class="value" id="pct">0%</div>
          <div class="cap">กำลังเตรียมความพร้อม</div>
        </div>

        <div class="copy">
          <h1>กำลังพาคุณไปยังเซิร์ฟเวอร์ที่ปลอดภัยที่สุด</h1>
          <p class="lead">ระบบจะเลือกเส้นทางที่เร็วและเสถียรโดยอัตโนมัติ</p>

          <div class="status-area">
            <div id="type" class="type" aria-live="polite"></div>
          </div>

          <div class="actions">
            <button id="goNow" class="btn" type="button">ไปต่อทันที</button>
            <button id="retry" class="btn secondary" type="button" title="Alt + R">ลองใหม่</button>
          </div>

          <div class="badges" aria-hidden="true">
            <div class="badge">iOS</div>
            <div class="badge">Android</div>
            <div class="badge">Windows</div>
            <div class="badge">macOS</div>
          </div>
        </div>
      </div>
    </div>

    <!-- WAVES DECORATION -->
    <div class="waves" aria-hidden="true">
      <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
        <path fill="currentColor" fill-opacity="0.14" d="M0,160L40,138.7C80,117,160,75,240,69.3C320,64,400,96,480,117.3C560,139,640,149,720,149.3C800,149,880,139,960,144C1040,149,1120,171,1200,181.3C1280,192,1360,192,1400,192L1440,192L1440,320L1400,320C1360,320,1280,320,1200,320C1120,320,1040,320,960,320C880,320,800,320,720,320C640,320,560,320,480,320C400,320,320,320,240,320C160,320,80,320,40,320L0,320Z"></path>
        <path fill="currentColor" fill-opacity="0.10" d="M0,64L30,53.3C60,43,120,21,180,48C240,75,300,149,360,170.7C420,192,480,160,540,144C600,128,660,128,720,117.3C780,107,840,85,900,96C960,107,1020,149,1080,165.3C1140,181,1200,171,1260,154.7C1320,139,1380,117,1410,106.7L1440,96L1440,320L1410,320C1380,320,1320,320,1260,320C1200,320,1140,320,1080,320C1020,320,960,320,900,320C840,320,780,320,720,320C660,320,600,320,540,320C480,320,420,320,360,320C300,320,240,320,180,320C120,320,60,320,30,320L0,320Z"></path>
      </svg>
    </div>
  </div>

  <script>
    // ==================== CONFIG ====================
    /**
     * เปลี่ยนโดเมนปลายทางที่นี่
     * ลำดับแนะนำ: ความเสถียรสูงสุดไว้ต้นรายการ
     */
    const SERVERS = [
      { url: 'https://viplaos-lala.online', label: 'เซิร์ฟเวอร์หลัก' },
      { url: 'https://viplaos-kula.online', label: 'สำรอง A' },
      { url: 'https://viplaos-tersa.online', label: 'สำรอง B' },
    ];

    // เวลาโดยประมาณก่อนเปลี่ยนหน้า (มิลลิวินาที)
    const CONNECT_TIME_MS = 2600;

    // ==================== THEME TOGGLE ====================
    const root = document.documentElement;
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) root.setAttribute('data-theme', savedTheme);
    document.getElementById('toggleTheme').addEventListener('click', () => {
      const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    });

    // ==================== PROGRESS / DIAL ====================
    const circle = document.getElementById('fg');
    const pct = document.getElementById('pct');
    const CIRC = 2 * Math.PI * 50; // r=50 => ~314

    function setProgress(p) {
      const clamped = Math.max(0, Math.min(100, p));
      const offset = CIRC * (1 - clamped / 100);
      circle.style.strokeDasharray = CIRC.toFixed(2);
      circle.style.strokeDashoffset = offset.toFixed(2);
      pct.textContent = Math.round(clamped) + '%';
    }

    // ==================== TYPEWRITER ====================
    const typer = document.getElementById('type');
    const messages = [
      'กำลังตรวจสอบคุณภาพเครือข่าย...',
      'เลือกเส้นทางที่เร็วที่สุด...',
      'ยืนยันการเข้ารหัสแบบ End‑to‑End...',
      'กำลังเตรียมเซสชันที่ปลอดภัย...',
      'เชื่อมต่อเซิร์ฟเวอร์สำเร็จ เตรียมเปลี่ยนหน้า...'
    ];

    let msgIndex = 0, charIndex = 0;
    function typeNext() {
      const text = messages[msgIndex % messages.length];
      typer.innerHTML = text.slice(0, charIndex++) + '<span class="caret"></span>';
      if (charIndex <= text.length) {
        setTimeout(typeNext, 14 + Math.random() * 30);
      } else {
        setTimeout(() => { charIndex = 0; msgIndex++; typeNext(); }, 900);
      }
    }

    // ==================== FLOW ====================
    let started = false;
    let timer;

    function beginFlow() {
      if (started) return; started = true;
      let p = 0; setProgress(0);
      const start = performance.now();

      function tick(now) {
        const elapsed = now - start;
        // Ease-out progression up to 96%
        const target = Math.min(96, (elapsed / CONNECT_TIME_MS) * 100);
        p = p + (target - p) * 0.12; // smoothing
        setProgress(p);
        if (elapsed < CONNECT_TIME_MS) {
          timer = requestAnimationFrame(tick);
        } else {
          setProgress(100);
          proceed();
        }
      }
      timer = requestAnimationFrame(tick);
    }

    function proceed() {
      // Strategy: ใช้ last-success server ก่อน (ถ้ามี)
      const last = localStorage.getItem('last_server');
      const list = [...SERVERS];
      if (last) {
        const i = list.findIndex(s => s.url === last);
        if (i > 0) { const [hit] = list.splice(i,1); list.unshift(hit); }
      }

      // เลือกตัวแรกเสมอ (หลังเรียงใหม่)
      const target = list[0];
      localStorage.setItem('last_server', target.url);

      // เปลี่ยนหน้าอย่างปลอดภัย: ใช้ replace เพื่อลดประวัติย้อนกลับ
      try { window.location.replace(target.url); }
      catch (e) {
        try { window.location.assign(target.url); }
        catch { window.open(target.url, '_self'); }
      }
    }

    // ==================== CONTROLS ====================
    document.getElementById('goNow').addEventListener('click', () => {
      setProgress(100);
      proceed();
    });

    document.getElementById('retry').addEventListener('click', () => {
      cancelAnimationFrame(timer);
      started = false; setProgress(0); msgIndex = 0; charIndex = 0; typer.textContent = '';
      setTimeout(() => { typeNext(); beginFlow(); }, 60);
    });

    window.addEventListener('keydown', (e) => {
      if (e.altKey && (e.key === 'r' || e.key === 'R')) {
        document.getElementById('retry').click();
      }
      if (e.altKey && (e.key === 'n' || e.key === 'N')) {
        document.getElementById('goNow').click();
      }
    });

    // ==================== INIT ====================
    window.addEventListener('load', () => {
      typeNext();
      setTimeout(beginFlow, 260);
    });
  </script>
</body>
</html>
